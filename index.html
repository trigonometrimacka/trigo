<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TRIGO AI - Ultimate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            touch-action: manipulation;
            overscroll-behavior: none;
            color: #E5E7EB;
            background-color: #111827; /* gray-900 */
        }

        .font-logo { font-family: 'Audiowide', sans-serif; letter-spacing: 1px; }
        
        /* Alt Navigasyon BarÄ± */
        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(17, 24, 39, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid #374151;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            z-index: 50;
            padding-bottom: max(10px, env(safe-area-inset-bottom));
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #9CA3AF;
            font-size: 0.75rem;
            background: none;
            border: none;
            cursor: pointer;
            transition: color 0.3s;
        }

        .nav-item.active {
            color: #E5AE32; /* AltÄ±n Rengi */
        }

        .nav-icon {
            font-size: 1.5rem;
            margin-bottom: 2px;
        }

        /* Sayfa Ä°Ã§erik AlanÄ± */
        .page-container {
            padding: 20px;
            padding-bottom: 100px; /* Nav bar iÃ§in boÅŸluk */
            display: none; /* VarsayÄ±lan gizli */
            animation: fadeIn 0.3s ease-out;
        }

        .page-container.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* YÃ¼kseklik Ã–lÃ§er Stilleri (Ã–nceki projeden) */
        .crosshair {
            position: relative;
            width: 150px;
            height: 150px;
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            margin: 20px auto;
        }
        .crosshair-line-v {
            position: absolute; top: 50%; left: calc(50% - 1px);
            height: 50px; width: 2px; background: rgba(229, 174, 50, 0.7);
            box-shadow: 0 0 8px rgba(229, 174, 50, 1); transform: translateY(-50%);
        }
        .crosshair-line-h {
            position: absolute; left: 50%; top: 50%; width: 50px; height: 2px;
            background: rgba(229, 174, 50, 0.7); box-shadow: 0 0 8px rgba(229, 174, 50, 1);
            transform: translateX(-50%) translateY(-1px); transition: transform 0.1s linear;
        }

        /* Canvas */
        canvas {
            background: #1F2937;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            width: 100%;
        }
    </style>
</head>
<body>

    <div class="fixed top-0 w-full bg-gray-900/90 backdrop-blur z-40 border-b border-gray-800 p-4 text-center">
        <h1 class="font-logo text-2xl text-[rgb(229,174,50)]">TRIGO AI</h1>
    </div>
    <div class="h-16"></div> <div id="page-home" class="page-container active w-full max-w-md mx-auto">
        <div class="bg-gray-800 rounded-2xl p-6 shadow-xl mb-6 border border-gray-700">
            <h2 class="text-xl font-bold text-white mb-4">Trigonometri Nedir Kanki?</h2>
            
            <canvas id="trigoCanvas" width="350" height="200" class="mb-4"></canvas>
            
            <div class="space-y-4 text-sm text-gray-300">
                <p>Bak ÅŸimdi, yukarÄ±daki animasyona iyi bak. Soldaki daire dÃ¶nÃ¼p duruyor ya?</p>
                <div class="bg-gray-700/50 p-3 rounded-lg border-l-4 border-[rgb(229,174,50)]">
                    <p class="text-white font-medium">MantÄ±k ÅŸu:</p>
                    <p>Dairenin iÃ§indeki Ã§ubuÄŸun <strong>GÃ–LGESÄ°</strong>, saÄŸ taraftaki dalgayÄ± oluÅŸturur.</p>
                </div>
                <p>Ä°ÅŸte o dalga <strong>SÄ°NÃœS</strong> dalgasÄ±dÄ±r. Hayattaki her ÅŸey (ses, Ä±ÅŸÄ±k, elektrik, deniz dalgasÄ±) aslÄ±nda dÃ¶nen bir dairenin gÃ¶lgesidir.</p>
                <p>Biz de bu uygulamada telefonunu bir Ã¼Ã§genin kenarÄ± gibi kullanÄ±p, binanÄ±n boyunu hesaplÄ±yoruz. Korkulacak bir ÅŸey yok, sadece daireler ve Ã¼Ã§genler!</p>
            </div>
        </div>
    </div>

    <div id="page-tool" class="page-container w-full max-w-md mx-auto">
        
        <div id="setup-screen" class="bg-gray-800 p-6 rounded-2xl shadow-xl border border-gray-700">
            <h2 class="text-xl font-bold text-white mb-2">YÃ¼kseklik Ã–lÃ§er</h2>
            <p class="text-xs text-gray-400 mb-6">Telefon sensÃ¶rleri ile trigonometrik hesaplama.</p>

            <div class="mb-4">
                <label class="block text-sm text-gray-300 mb-1">Cisme UzaklÄ±k (m)</label>
                <input type="number" id="distance" value="10" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-[rgb(229,174,50)] outline-none">
            </div>

            <div class="mb-6">
                <label class="block text-sm text-gray-300 mb-1">Cihaz YÃ¼ksekliÄŸi (m)</label>
                <input type="number" id="userHeight" value="1.7" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-[rgb(229,174,50)] outline-none">
            </div>

            <button id="startButton" class="w-full bg-[rgb(229,174,50)] text-black p-4 rounded-lg font-bold hover:bg-[rgb(209,154,30)] transition active:scale-95">
                Ã–lÃ§Ã¼mÃ¼ BaÅŸlat
            </button>
            <p id="permission-status" class="text-center text-[rgb(229,174,50)] text-xs mt-3 h-4"></p>
        </div>

        <div id="measurement-screen" class="hidden bg-gray-800 p-6 rounded-2xl shadow-xl border border-gray-700 text-center">
            <p class="text-xs text-gray-400 uppercase tracking-widest mb-2">Aktif Ã–lÃ§Ã¼m</p>
            
            <div class="crosshair">
                <div id="crosshair-h" class="crosshair-line-h"></div>
                <div class="crosshair-line-v"></div>
            </div>

            <div id="heightDisplay" class="text-5xl font-extrabold text-white my-2">0.00 m</div>
            
            <div class="flex justify-between bg-gray-900/50 rounded-lg p-3 my-4">
                <div>
                    <div class="text-[10px] text-[rgb(229,174,50)] uppercase">AÃ§Ä± (Î²)</div>
                    <div id="angleDisplay" class="text-xl font-bold text-white">0.0Â°</div>
                </div>
                <div>
                    <div class="text-[10px] text-[rgb(229,174,50)] uppercase">KararlÄ±lÄ±k</div>
                    <div id="stabilityDisplay" class="text-xl font-bold text-white">--%</div>
                </div>
            </div>

            <div class="w-full bg-gray-700 rounded-full h-2 mb-4 overflow-hidden">
                <div id="stabilityBar" class="bg-[rgb(229,174,50)] h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>

            <p id="aiFeedback" class="text-xs text-[rgb(229,174,50)] mb-4">AI: Bekleniyor...</p>

            <button id="resetButton" class="w-full bg-red-600/90 text-white p-3 rounded-lg font-bold text-sm hover:bg-red-700 active:scale-95">
                Bitir
            </button>
        </div>
    </div>

    <div id="page-audio" class="page-container w-full max-w-md mx-auto">
        <div class="bg-gray-800 rounded-2xl p-6 shadow-xl border border-gray-700">
            <h2 class="text-xl font-bold text-white mb-2">Sesin Geometrisi</h2>
            <p class="text-sm text-gray-400 mb-4">KonuÅŸtuÄŸunda havaya matematik fÄ±rlatÄ±yorsun.</p>

            <canvas id="audioCanvas" width="350" height="150" class="mb-4 border border-gray-600"></canvas>

            <div id="audio-controls" class="text-center mb-6">
                <button id="btn-audio-start" class="w-full bg-blue-600 text-white p-3 rounded-lg font-bold hover:bg-blue-500 transition active:scale-95">
                    Mikrofonu AÃ§ & Analiz Et
                </button>
                <button id="btn-audio-stop" class="hidden w-full bg-red-600 text-white p-3 rounded-lg font-bold hover:bg-red-500 transition active:scale-95">
                    Durdur
                </button>
            </div>

            <div class="space-y-4 text-sm text-gray-300">
                <h3 class="font-bold text-white">Bu Ã‡izgiler Ne?</h3>
                <p>Az Ã¶nce "Ana Sayfa"da gÃ¶rdÃ¼ÄŸÃ¼n o dalga vardÄ± ya? Ä°ÅŸte sesin aynen o.</p>
                <ul class="list-disc pl-5 space-y-2">
                    <li>Sesin kalÄ±nlaÅŸÄ±nca dalgalar <strong>geniÅŸler</strong> (Frekans dÃ¼ÅŸer).</li>
                    <li>BaÄŸÄ±rdÄ±ÄŸÄ±nda dalgalar <strong>uzar</strong> (Genlik artar).</li>
                </ul>
                <div class="p-3 bg-gray-900 rounded-lg text-xs text-gray-400 italic">
                    "Kanki, aslÄ±nda kulaklarÄ±mÄ±z biyolojik birer trigonometri hesap makinesidir. Bu dalgalarÄ± alÄ±p beyne sinyal yollar."
                </div>
            </div>
        </div>
    </div>

    <nav class="nav-bar">
        <button class="nav-item active" onclick="switchPage('home')">
            <span class="nav-icon">ğŸ“</span>
            <span>Konu</span>
        </button>
        <button class="nav-item" onclick="switchPage('tool')">
            <span class="nav-icon">ğŸ“</span>
            <span>Ã–lÃ§er</span>
        </button>
        <button class="nav-item" onclick="switchPage('audio')">
            <span class="nav-icon">ğŸ™ï¸</span>
            <span>Ses Analiz</span>
        </button>
    </nav>

    <script>
        // ================= NAVÄ°GASYON YÃ–NETÄ°MÄ° =================
        function switchPage(pageName) {
            // TÃ¼m sayfalarÄ± gizle
            document.querySelectorAll('.page-container').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));

            // Ä°lgili sayfayÄ± aÃ§
            document.getElementById(`page-${pageName}`).classList.add('active');
            
            // Ä°lgili butonu aktif yap
            const buttonIndex = ['home', 'tool', 'audio'].indexOf(pageName);
            document.querySelectorAll('.nav-item')[buttonIndex].classList.add('active');

            // Sayfa Ã¶zel durumlarÄ±
            if(pageName === 'home') startTrigoAnimation();
            else stopTrigoAnimation();
        }

        // ================= BÃ–LÃœM 1: TRÄ°GONOMETRÄ° ANÄ°MASYONU (HOME) =================
        const trigoCanvas = document.getElementById('trigoCanvas');
        const tCtx = trigoCanvas.getContext('2d');
        let trigoAnimId;
        let angle = 0;

        function drawTrigo() {
            // Canvas temizle
            tCtx.fillStyle = '#1F2937';
            tCtx.fillRect(0, 0, trigoCanvas.width, trigoCanvas.height);

            const cx = 60; // Daire merkezi X
            const cy = 100; // Daire merkezi Y
            const r = 40; // YarÄ±Ã§ap

            // 1. Daireyi Ã‡iz
            tCtx.beginPath();
            tCtx.strokeStyle = '#4B5563';
            tCtx.lineWidth = 2;
            tCtx.arc(cx, cy, r, 0, Math.PI * 2);
            tCtx.stroke();

            // 2. DÃ¶nen Nokta
            const rad = angle * (Math.PI / 180);
            const px = cx + r * Math.cos(rad);
            const py = cy + r * Math.sin(rad);

            // Merkezden noktaya Ã§izgi
            tCtx.beginPath();
            tCtx.strokeStyle = 'white';
            tCtx.moveTo(cx, cy);
            tCtx.lineTo(px, py);
            tCtx.stroke();

            // Nokta
            tCtx.beginPath();
            tCtx.fillStyle = '#E5AE32';
            tCtx.arc(px, py, 4, 0, Math.PI * 2);
            tCtx.fill();

            // 3. Dalga Ã‡izimi
            tCtx.beginPath();
            tCtx.moveTo(px, py);
            // Daireden dalgaya baÄŸlantÄ± Ã§izgisi (kesikli)
            tCtx.lineTo(140, py);
            tCtx.strokeStyle = 'rgba(229, 174, 50, 0.3)';
            tCtx.setLineDash([5, 3]);
            tCtx.stroke();
            tCtx.setLineDash([]);

            // SinÃ¼s DalgasÄ±nÄ± Ã‡iz
            tCtx.beginPath();
            tCtx.strokeStyle = '#E5AE32';
            tCtx.lineWidth = 3;
            
            let startX = 140;
            // DalgayÄ± Ã§izmek iÃ§in geÃ§miÅŸ aÃ§Ä±larÄ± kullanabiliriz veya matematiksel hesap
            // Basitlik iÃ§in: x ekseninde ilerledikÃ§e sinÃ¼sÃ¼ Ã§izelim
            for (let x = 0; x < 200; x++) {
                // x burada zamanÄ± temsil ediyor. 
                // Åu anki aÃ§Ä±dan geriye doÄŸru gidiyoruz gibi simÃ¼le edelim.
                let waveY = cy + r * Math.sin(rad - (x * 0.1));
                tCtx.lineTo(startX + x, waveY);
            }
            tCtx.stroke();

            angle -= 2; // DÃ¶nÃ¼ÅŸ hÄ±zÄ±
            trigoAnimId = requestAnimationFrame(drawTrigo);
        }

        function startTrigoAnimation() {
            if(!trigoAnimId) drawTrigo();
        }
        function stopTrigoAnimation() {
            if(trigoAnimId) {
                cancelAnimationFrame(trigoAnimId);
                trigoAnimId = null;
            }
        }
        // BaÅŸlangÄ±Ã§ta Ã§alÄ±ÅŸtÄ±r
        startTrigoAnimation();

        // ================= BÃ–LÃœM 2: YÃœKSEKLÄ°K Ã–LÃ‡ER (TOOL) =================
        // DeÄŸiÅŸkenler
        let distance = 10, userHeight = 1.7;
        let angleHistory = [];
        const historySize = 20;
        
        // Elementler
        const setupScreen = document.getElementById('setup-screen');
        const measureScreen = document.getElementById('measurement-screen');
        const hDisplay = document.getElementById('heightDisplay');
        const aDisplay = document.getElementById('angleDisplay');
        const sDisplay = document.getElementById('stabilityDisplay');
        const sBar = document.getElementById('stabilityBar');
        const aiFb = document.getElementById('aiFeedback');
        const crossH = document.getElementById('crosshair-h');

        function tan(deg) { return Math.tan(deg * Math.PI / 180); }

        function handleOrientation(event) {
            let beta = event.beta; 
            if(beta === null) return;
            
            // Basit koruma
            if(beta < 0) beta = 0; 
            if(beta > 90) beta = 90;

            // Stabilizasyon (Ortalama alma)
            angleHistory.push(beta);
            if(angleHistory.length > historySize) angleHistory.shift();

            const avgAngle = angleHistory.reduce((a,b)=>a+b,0) / angleHistory.length;
            
            // Standart Sapma (KararlÄ±lÄ±k iÃ§in)
            const variance = angleHistory.reduce((a,b)=>a+Math.pow(b-avgAngle,2),0) / angleHistory.length;
            const stability = Math.max(0, 100 * (1 - Math.sqrt(variance)/2));

            // Hesaplama
            const objH = tan(avgAngle) * distance;
            const totalH = objH + userHeight;

            // UI GÃ¼ncelleme
            // NiÅŸangah Hareketi
            const yShift = -(avgAngle / 90) * 40;
            crossH.style.transform = `translateX(-50%) translateY(calc(-1px + ${yShift}px))`;

            if(angleHistory.length > 5) {
                hDisplay.textContent = `${totalH.toFixed(2)} m`;
                aDisplay.textContent = `${avgAngle.toFixed(1)}Â°`;
                sDisplay.textContent = `${stability.toFixed(0)}%`;
                sBar.style.width = `${stability.toFixed(0)}%`;
                
                if(stability < 60) aiFb.textContent = "AI: Elin titriyor kanki, derin nefes al.";
                else if(stability > 90) aiFb.textContent = "AI: MÃ¼kemmel, Ã§ok net!";
                else aiFb.textContent = "AI: Ã–lÃ§Ã¼m yapÄ±lÄ±yor...";
            }
        }

        document.getElementById('startButton').addEventListener('click', () => {
            distance = parseFloat(document.getElementById('distance').value);
            userHeight = parseFloat(document.getElementById('userHeight').value);
            
            // Ä°zin Ä°ste
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(state => {
                        if (state === 'granted') {
                            startTool();
                        } else {
                            document.getElementById('permission-status').textContent = "Ä°zin verilmedi kanki.";
                        }
                    })
                    .catch(console.error);
            } else {
                startTool();
            }
        });

        function startTool() {
            setupScreen.classList.add('hidden');
            measureScreen.classList.remove('hidden');
            window.addEventListener('deviceorientation', handleOrientation);
        }

        document.getElementById('resetButton').addEventListener('click', () => {
            window.removeEventListener('deviceorientation', handleOrientation);
            setupScreen.classList.remove('hidden');
            measureScreen.classList.add('hidden');
            angleHistory = [];
        });

        // ================= BÃ–LÃœM 3: SES ANALÄ°ZÄ° (AUDIO) =================
        let audioCtx, analyser, source, audioAnimId;
        const audioCanvas = document.getElementById('audioCanvas');
        const aCtx = audioCanvas.getContext('2d');
        const btnAudioStart = document.getElementById('btn-audio-start');
        const btnAudioStop = document.getElementById('btn-audio-stop');

        async function startAudio() {
            try {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioCtx.createAnalyser();
                analyser.fftSize = 2048; // Ã‡Ã¶zÃ¼nÃ¼rlÃ¼k

                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                source = audioCtx.createMediaStreamSource(stream);
                source.connect(analyser);

                drawAudioWave();
                
                btnAudioStart.classList.add('hidden');
                btnAudioStop.classList.remove('hidden');

            } catch (err) {
                alert("Mikrofon izni lazÄ±m kanki: " + err);
            }
        }

        function stopAudio() {
            if(audioCtx) audioCtx.close();
            if(audioAnimId) cancelAnimationFrame(audioAnimId);
            
            btnAudioStart.classList.remove('hidden');
            btnAudioStop.classList.add('hidden');
            
            // CanvasÄ± temizle
            aCtx.clearRect(0,0,audioCanvas.width, audioCanvas.height);
        }

        function drawAudioWave() {
            audioAnimId = requestAnimationFrame(drawAudioWave);

            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            analyser.getByteTimeDomainData(dataArray);

            aCtx.fillStyle = '#1F2937';
            aCtx.fillRect(0, 0, audioCanvas.width, audioCanvas.height);

            aCtx.lineWidth = 2;
            aCtx.strokeStyle = '#3B82F6'; // Mavi renk
            aCtx.beginPath();

            const sliceWidth = audioCanvas.width * 1.0 / bufferLength;
            let x = 0;

            for(let i = 0; i < bufferLength; i++) {
                const v = dataArray[i] / 128.0; // 0 ile 2 arasÄ± deÄŸer
                const y = v * audioCanvas.height / 2;

                if(i === 0) aCtx.moveTo(x, y);
                else aCtx.lineTo(x, y);

                x += sliceWidth;
            }

            aCtx.lineTo(audioCanvas.width, audioCanvas.height / 2);
            aCtx.stroke();
        }

        btnAudioStart.addEventListener('click', startAudio);
        btnAudioStop.addEventListener('click', stopAudio);

    </script>
</body>
</html>
