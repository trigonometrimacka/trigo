<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>A√ßƒ± + Kamera: Geli≈ümi≈ü Y√ºkseklik √ñl√ßer</title>
<style>
  :root{
    --bg1:#012E40; --bg2:#026773; --accent:#3CA6A6; --text:#F2E3D5;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  body{
    font-family:Poppins,Inter,sans-serif;
    background:linear-gradient(135deg,var(--bg1),var(--bg2));
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    overflow-x:hidden;
  }
  header{
    display:flex;align-items:center;justify-content:space-between;
    padding:1rem;background:rgba(0,0,0,0.2);
  }
  h1{font-size:1.2rem;color:var(--accent)}
  #menuBtn{
    font-size:1.5rem;background:none;border:none;color:var(--text);
    cursor:pointer;
  }
  /* === yan men√º === */
  #sideMenu{
    position:fixed;top:0;left:-260px;width:260px;height:100%;
    background-color:rgba(0,0,0,0.95);
    backdrop-filter:blur(6px);
    padding:1rem;transition:0.3s;
    z-index:10;
  }
  #sideMenu.open{left:0;}
  #sideMenu h2{font-size:1rem;color:var(--accent);margin-bottom:0.5rem;}
  #sideMenu label{display:block;margin-top:0.8rem;}
  #sideMenu select, #sideMenu input{
    width:100%;padding:0.4rem;margin-top:0.3rem;
    border:none;border-radius:6px;text-align:center;
  }
  #sideMenu button{
    width:100%;margin-top:0.8rem;padding:0.5rem;border:none;
    border-radius:6px;background:var(--accent);color:var(--bg1);
    cursor:pointer;
  }
  .preview{position:relative;width:100%;max-width:480px;margin:1rem auto;border-radius:12px;overflow:hidden;}
  video,canvas{width:100%;height:auto;display:block;}
  .readout{
    max-width:480px;margin:0 auto;
    text-align:center;padding:0.8rem;background:rgba(0,0,0,0.3);
    border-radius:12px;
  }
  .readout div{margin:0.3rem 0;font-size:1rem;}
</style>
</head>
<body>
  <header>
    <h1>üìê A√ßƒ± + Kamera √ñl√ßer</h1>
    <button id="menuBtn">‚ò∞</button>
  </header>

  <!-- Yan Men√º -->
  <aside id="sideMenu">
    <h2>‚öôÔ∏è Ayarlar</h2>
    <label>Mesafe (m):</label>
    <input id="distance" type="number" step="0.1" value="2">
    <label>Telefon Y√ºksekliƒüi (m):</label>
    <input id="deviceHeight" type="number" step="0.1" value="1.6">
    <label>Kamera Oranƒ±:</label>
    <select id="ratioSelect">
      <option value="16:9">16 : 9</option>
      <option value="9:16">9 : 16</option>
      <option value="4:3">4 : 3</option>
    </select>
    <label>Mod:</label>
    <select id="modeSelect">
      <option value="camera">Kamera + A√ßƒ±</option>
      <option value="sensor">Sadece A√ßƒ±</option>
    </select>
    <button id="startBtn">Ba≈ülat</button>
    <button id="stopBtn">Durdur</button>
  </aside>

  <main>
    <div class="preview" id="previewWrap">
      <video id="video" autoplay playsinline muted></video>
      <canvas id="overlay"></canvas>
    </div>
    <div class="readout">
      <div>A√ßƒ± (Œ≤): <span id="angleVal">‚Äî ¬∞</span></div>
      <div>Hesaplanan Y√ºkseklik: <span id="heightVal">‚Äî</span></div>
    </div>
  </main>

<script>
const menuBtn = document.getElementById('menuBtn');
const sideMenu = document.getElementById('sideMenu');
menuBtn.onclick=()=>sideMenu.classList.toggle('open');

const video=document.getElementById('video');
const canvas=document.getElementById('overlay');
const ctx=canvas.getContext('2d');

const ratioSelect=document.getElementById('ratioSelect');
const modeSelect=document.getElementById('modeSelect');
const distanceInput=document.getElementById('distance');
const deviceHeightInput=document.getElementById('deviceHeight');
const angleVal=document.getElementById('angleVal');
const heightVal=document.getElementById('heightVal');
const startBtn=document.getElementById('startBtn');
const stopBtn=document.getElementById('stopBtn');

let running=false, stream=null, beta=0;

function toRad(deg){return deg*Math.PI/180;}

async function startAll(){
  if(running) return;
  let ratio = ratioSelect.value.split(':');
  let w=16, h=9;
  if(ratio.length===2){ w=parseInt(ratio[0]); h=parseInt(ratio[1]); }
  const aspect = w/h;
  const constraints={
    video:{facingMode:"environment",aspectRatio:aspect}
  };
  if(modeSelect.value==="camera"){
    try{
      stream=await navigator.mediaDevices.getUserMedia(constraints);
      video.srcObject=stream;
      await video.play();
      fitCanvas();
    }catch(err){alert("Kamera a√ßƒ±lamadƒ±: "+err);}
  }
  if(typeof DeviceOrientationEvent.requestPermission==="function"){
    try{
      const r=await DeviceOrientationEvent.requestPermission();
      if(r!=="granted")alert("Sens√∂r izni reddedildi!");
    }catch{}
  }
  window.addEventListener('deviceorientation',handleOrientation);
  running=true;
  loop();
  sideMenu.classList.remove('open');
}

function stopAll(){
  running=false;
  if(stream){stream.getTracks().forEach(t=>t.stop());stream=null;}
  window.removeEventListener('deviceorientation',handleOrientation);
  cancelAnimationFrame(animId);
  ctx.clearRect(0,0,canvas.width,canvas.height);
  video.srcObject=null;
}

function fitCanvas(){
  canvas.width=video.videoWidth;
  canvas.height=video.videoHeight;
}

function handleOrientation(e){
  beta=e.beta||0;
  angleVal.textContent=beta.toFixed(1)+" ¬∞";
}

let animId;
function loop(){
  if(!running)return;
  drawOverlay();
  animId=requestAnimationFrame(loop);
}

function drawOverlay(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.strokeStyle="rgba(255,80,80,0.9)";
  ctx.lineWidth=3;
  ctx.beginPath();
  ctx.moveTo(canvas.width/2,canvas.height);
  let y=canvas.height - Math.tan(toRad(beta))*200; // sadece g√∂rsel ama√ßlƒ± √ßizgi
  ctx.lineTo(canvas.width/2,y);
  ctx.stroke();

  let d=parseFloat(distanceInput.value)||1;
  let z=parseFloat(deviceHeightInput.value)||0;
  let h=z+Math.tan(toRad(beta))*d;
  heightVal.textContent=h.toFixed(2)+" m";
}

startBtn.onclick=startAll;
stopBtn.onclick=stopAll;
video.onloadedmetadata=fitCanvas;
</script>
</body>
</html>
